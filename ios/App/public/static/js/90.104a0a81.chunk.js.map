{"version":3,"sources":["../node_modules/@ionic/core/dist/esm-es5/ion-virtual-scroll.entry.js"],"names":["__webpack_require__","r","__webpack_exports__","d","VirtualScroll","tslib__WEBPACK_IMPORTED_MODULE_0__","_core_13ed1ad7_js__WEBPACK_IMPORTED_MODULE_1__","createNode","el","type","template","getTemplate","ownerDocument","importNode","content","children","querySelector","calcCells","items","itemHeight","headerHeight","footerHeight","headerFn","footerFn","approxHeaderHeight","approxFooterHeight","approxItemHeight","j","offset","len","cells","end","i","value","item","push","index","height","reads","visible","class_1","hostRef","_this","this","Object","range","length","viewportHeight","virtualDom","isEnabled","viewportOffset","currentScrollTop","indexDirty","lastItemLen","totalHeight","onScroll","updateVirtualScroll","prototype","itemsChanged","componentDidLoad","contentEl","_a","_b","label","closest","componentOnReady","console","error","sent","getScrollElement","scrollEl","updateState","componentDidUpdate","componentDidUnload","undefined","onResize","positionForItem","Promise","resolve","heightIndex","cell","find","c","positionForIndex","getHeightIndex","checkRange","cellIndex","max","findIndex","findCellIndex","dst","src","inplaceUpdate","Math","scheduleUpdate","checkEnd","timerUpdate","clearTimeout","readVS","bind","writeVS","topOffset","node","offsetTop","parentElement","offsetHeight","scrollTop","dirtyIndex","viewport","vierportHeight","margin","top","bottom","getViewport","buffer","topPos","bottomPos","min","getRange","currentRange","getShouldUpdate","dom","_i","dom_1","change","toMutate","_loop_1","n","pool","filter","_loop_2","toMutate_1","forEach","updateVDom","nodeRender","updateCellHeight","child","Array","from","tagName","childrenNu","newChild","classList","add","appendChild","style","transform","remove","doRender","domRender","renderItem","forceUpdate","update","window","getComputedStyle","parseFloat","getPropertyValue","setCellHeight","then","setTimeout","shouldEnable","enableScrollEvents","Infinity","calcHeightIndex","buf","Uint32Array","newBuf","set","subarray","resizeBuffer","acum","shouldListen","rmEvent","addEventListener","removeEventListener","renderVirtualNode","renderHeader","renderFooter","render","VirtualProxy","map","defineProperty","get","enumerable","configurable","utils","vattrs","classes","class","assign"],"mappings":"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","file":"static/js/90.104a0a81.chunk.js","sourcesContent":["import * as tslib_1 from \"tslib\";\nimport { r as registerInstance, f as readTask, w as writeTask, h, H as Host, e as getElement } from './core-13ed1ad7.js';\nimport './config-bb99b659.js';\nvar CELL_TYPE_ITEM = 'item';\nvar CELL_TYPE_HEADER = 'header';\nvar CELL_TYPE_FOOTER = 'footer';\nvar NODE_CHANGE_NONE = 0;\nvar NODE_CHANGE_POSITION = 1;\nvar NODE_CHANGE_CELL = 2;\nvar MIN_READS = 2;\n\nvar updateVDom = function updateVDom(dom, heightIndex, cells, range) {\n  // reset dom\n  for (var _i = 0, dom_1 = dom; _i < dom_1.length; _i++) {\n    var node = dom_1[_i];\n    node.change = NODE_CHANGE_NONE;\n    node.d = true;\n  } // try to match into exisiting dom\n\n\n  var toMutate = [];\n  var end = range.offset + range.length;\n\n  var _loop_1 = function _loop_1(i) {\n    var cell = cells[i];\n    var node = dom.find(function (n) {\n      return n.d && n.cell === cell;\n    });\n\n    if (node) {\n      var top = heightIndex[i];\n\n      if (top !== node.top) {\n        node.top = top;\n        node.change = NODE_CHANGE_POSITION;\n      }\n\n      node.d = false;\n    } else {\n      toMutate.push(cell);\n    }\n  };\n\n  for (var i = range.offset; i < end; i++) {\n    _loop_1(i);\n  } // needs to append\n\n\n  var pool = dom.filter(function (n) {\n    return n.d;\n  });\n\n  var _loop_2 = function _loop_2(cell) {\n    var node = pool.find(function (n) {\n      return n.d && n.cell.type === cell.type;\n    });\n    var index = cell.i;\n\n    if (node) {\n      node.d = false;\n      node.change = NODE_CHANGE_CELL;\n      node.cell = cell;\n      node.top = heightIndex[index];\n    } else {\n      dom.push({\n        d: false,\n        cell: cell,\n        visible: true,\n        change: NODE_CHANGE_CELL,\n        top: heightIndex[index]\n      });\n    }\n  };\n\n  for (var _a = 0, toMutate_1 = toMutate; _a < toMutate_1.length; _a++) {\n    var cell = toMutate_1[_a];\n\n    _loop_2(cell);\n  }\n\n  dom.filter(function (n) {\n    return n.d && n.top !== -9999;\n  }).forEach(function (n) {\n    n.change = NODE_CHANGE_POSITION;\n    n.top = -9999;\n  });\n};\n\nvar doRender = function doRender(el, nodeRender, dom, updateCellHeight) {\n  var children = Array.from(el.children).filter(function (n) {\n    return n.tagName !== 'TEMPLATE';\n  });\n  var childrenNu = children.length;\n  var child;\n\n  for (var i = 0; i < dom.length; i++) {\n    var node = dom[i];\n    var cell = node.cell; // the cell change, the content must be updated\n\n    if (node.change === NODE_CHANGE_CELL) {\n      if (i < childrenNu) {\n        child = children[i];\n        nodeRender(child, cell, i);\n      } else {\n        var newChild = createNode(el, cell.type);\n        child = nodeRender(newChild, cell, i) || newChild;\n        child.classList.add('virtual-item');\n        el.appendChild(child);\n      }\n\n      child['$ionCell'] = cell;\n    } else {\n      child = children[i];\n    } // only update position when it changes\n\n\n    if (node.change !== NODE_CHANGE_NONE) {\n      child.style.transform = \"translate3d(0,\" + node.top + \"px,0)\";\n    } // update visibility\n\n\n    var visible = cell.visible;\n\n    if (node.visible !== visible) {\n      if (visible) {\n        child.classList.remove('virtual-loading');\n      } else {\n        child.classList.add('virtual-loading');\n      }\n\n      node.visible = visible;\n    } // dynamic height\n\n\n    if (cell.reads > 0) {\n      updateCellHeight(cell, child);\n      cell.reads--;\n    }\n  }\n};\n\nvar createNode = function createNode(el, type) {\n  var template = getTemplate(el, type);\n\n  if (template && el.ownerDocument) {\n    return el.ownerDocument.importNode(template.content, true).children[0];\n  }\n\n  return null;\n};\n\nvar getTemplate = function getTemplate(el, type) {\n  switch (type) {\n    case CELL_TYPE_ITEM:\n      return el.querySelector('template:not([name])');\n\n    case CELL_TYPE_HEADER:\n      return el.querySelector('template[name=header]');\n\n    case CELL_TYPE_FOOTER:\n      return el.querySelector('template[name=footer]');\n  }\n};\n\nvar getViewport = function getViewport(scrollTop, vierportHeight, margin) {\n  return {\n    top: Math.max(scrollTop - margin, 0),\n    bottom: scrollTop + vierportHeight + margin\n  };\n};\n\nvar getRange = function getRange(heightIndex, viewport, buffer) {\n  var topPos = viewport.top;\n  var bottomPos = viewport.bottom; // find top index\n\n  var i = 0;\n\n  for (; i < heightIndex.length; i++) {\n    if (heightIndex[i] > topPos) {\n      break;\n    }\n  }\n\n  var offset = Math.max(i - buffer - 1, 0); // find bottom index\n\n  for (; i < heightIndex.length; i++) {\n    if (heightIndex[i] >= bottomPos) {\n      break;\n    }\n  }\n\n  var end = Math.min(i + buffer, heightIndex.length);\n  var length = end - offset;\n  return {\n    offset: offset,\n    length: length\n  };\n};\n\nvar getShouldUpdate = function getShouldUpdate(dirtyIndex, currentRange, range) {\n  var end = range.offset + range.length;\n  return dirtyIndex <= end || currentRange.offset !== range.offset || currentRange.length !== range.length;\n};\n\nvar findCellIndex = function findCellIndex(cells, index) {\n  var max = cells.length > 0 ? cells[cells.length - 1].index : 0;\n\n  if (index === 0) {\n    return 0;\n  } else if (index === max + 1) {\n    return cells.length;\n  } else {\n    return cells.findIndex(function (c) {\n      return c.index === index;\n    });\n  }\n};\n\nvar inplaceUpdate = function inplaceUpdate(dst, src, offset) {\n  if (offset === 0 && src.length >= dst.length) {\n    return src;\n  }\n\n  for (var i = 0; i < src.length; i++) {\n    dst[i + offset] = src[i];\n  }\n\n  return dst;\n};\n\nvar calcCells = function calcCells(items, itemHeight, headerHeight, footerHeight, headerFn, footerFn, approxHeaderHeight, approxFooterHeight, approxItemHeight, j, offset, len) {\n  var cells = [];\n  var end = len + offset;\n\n  for (var i = offset; i < end; i++) {\n    var item = items[i];\n\n    if (headerFn) {\n      var value = headerFn(item, i, items);\n\n      if (value != null) {\n        cells.push({\n          i: j++,\n          type: CELL_TYPE_HEADER,\n          value: value,\n          index: i,\n          height: headerHeight ? headerHeight(value, i) : approxHeaderHeight,\n          reads: headerHeight ? 0 : MIN_READS,\n          visible: !!headerHeight\n        });\n      }\n    }\n\n    cells.push({\n      i: j++,\n      type: CELL_TYPE_ITEM,\n      value: item,\n      index: i,\n      height: itemHeight ? itemHeight(item, i) : approxItemHeight,\n      reads: itemHeight ? 0 : MIN_READS,\n      visible: !!itemHeight\n    });\n\n    if (footerFn) {\n      var value = footerFn(item, i, items);\n\n      if (value != null) {\n        cells.push({\n          i: j++,\n          type: CELL_TYPE_FOOTER,\n          value: value,\n          index: i,\n          height: footerHeight ? footerHeight(value, i) : approxFooterHeight,\n          reads: footerHeight ? 0 : MIN_READS,\n          visible: !!footerHeight\n        });\n      }\n    }\n  }\n\n  return cells;\n};\n\nvar calcHeightIndex = function calcHeightIndex(buf, cells, index) {\n  var acum = buf[index];\n\n  for (var i = index; i < buf.length; i++) {\n    buf[i] = acum;\n    acum += cells[i].height;\n  }\n\n  return acum;\n};\n\nvar resizeBuffer = function resizeBuffer(buf, len) {\n  if (!buf) {\n    return new Uint32Array(len);\n  }\n\n  if (buf.length === len) {\n    return buf;\n  } else if (len > buf.length) {\n    var newBuf = new Uint32Array(len);\n    newBuf.set(buf);\n    return newBuf;\n  } else {\n    return buf.subarray(0, len);\n  }\n};\n\nvar positionForIndex = function positionForIndex(index, cells, heightIndex) {\n  var cell = cells.find(function (c) {\n    return c.type === CELL_TYPE_ITEM && c.index === index;\n  });\n\n  if (cell) {\n    return heightIndex[cell.i];\n  }\n\n  return -1;\n};\n\nvar VirtualScroll =\n/** @class */\nfunction () {\n  function class_1(hostRef) {\n    var _this = this;\n\n    registerInstance(this, hostRef);\n    this.range = {\n      offset: 0,\n      length: 0\n    };\n    this.viewportHeight = 0;\n    this.cells = [];\n    this.virtualDom = [];\n    this.isEnabled = false;\n    this.viewportOffset = 0;\n    this.currentScrollTop = 0;\n    this.indexDirty = 0;\n    this.lastItemLen = 0;\n    this.totalHeight = 0;\n    /**\n     * It is important to provide this\n     * if virtual item height will be significantly larger than the default\n     * The approximate height of each virtual item template's cell.\n     * This dimension is used to help determine how many cells should\n     * be created when initialized, and to help calculate the height of\n     * the scrollable area. This height value can only use `px` units.\n     * Note that the actual rendered size of each cell comes from the\n     * app's CSS, whereas this approximation is used to help calculate\n     * initial dimensions before the item has been rendered.\n     */\n\n    this.approxItemHeight = 45;\n    /**\n     * The approximate height of each header template's cell.\n     * This dimension is used to help determine how many cells should\n     * be created when initialized, and to help calculate the height of\n     * the scrollable area. This height value can only use `px` units.\n     * Note that the actual rendered size of each cell comes from the\n     * app's CSS, whereas this approximation is used to help calculate\n     * initial dimensions before the item has been rendered.\n     */\n\n    this.approxHeaderHeight = 30;\n    /**\n     * The approximate width of each footer template's cell.\n     * This dimension is used to help determine how many cells should\n     * be created when initialized, and to help calculate the height of\n     * the scrollable area. This height value can only use `px` units.\n     * Note that the actual rendered size of each cell comes from the\n     * app's CSS, whereas this approximation is used to help calculate\n     * initial dimensions before the item has been rendered.\n     */\n\n    this.approxFooterHeight = 30;\n\n    this.onScroll = function () {\n      _this.updateVirtualScroll();\n    };\n  }\n\n  class_1.prototype.itemsChanged = function () {\n    this.calcCells();\n    this.updateVirtualScroll();\n  };\n\n  class_1.prototype.componentDidLoad = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var contentEl, _a;\n\n      return tslib_1.__generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            contentEl = this.el.closest('ion-content');\n\n            if (!contentEl) {\n              console.error('virtual-scroll must be used inside ion-content');\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , contentEl.componentOnReady()];\n\n          case 1:\n            _b.sent();\n\n            this.contentEl = contentEl;\n            _a = this;\n            return [4\n            /*yield*/\n            , contentEl.getScrollElement()];\n\n          case 2:\n            _a.scrollEl = _b.sent();\n            this.calcCells();\n            this.updateState();\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  class_1.prototype.componentDidUpdate = function () {\n    this.updateState();\n  };\n\n  class_1.prototype.componentDidUnload = function () {\n    this.scrollEl = undefined;\n  };\n\n  class_1.prototype.onResize = function () {\n    this.calcCells();\n    this.updateVirtualScroll();\n  };\n  /**\n   * Returns the position of the virtual item at the given index.\n   */\n\n\n  class_1.prototype.positionForItem = function (index) {\n    return Promise.resolve(positionForIndex(index, this.cells, this.getHeightIndex()));\n  };\n  /**\n   * This method marks a subset of items as dirty, so they can be re-rendered. Items should be marked as\n   * dirty any time the content or their style changes.\n   *\n   * The subset of items to be updated can are specifing by an offset and a length.\n   */\n\n\n  class_1.prototype.checkRange = function (offset, len) {\n    if (len === void 0) {\n      len = -1;\n    }\n\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var length, cellIndex, cells;\n      return tslib_1.__generator(this, function (_a) {\n        // TODO: kind of hacky how we do in-place updated of the cells\n        // array. this part needs a complete refactor\n        if (!this.items) {\n          return [2\n          /*return*/\n          ];\n        }\n\n        length = len === -1 ? this.items.length - offset : len;\n        cellIndex = findCellIndex(this.cells, offset);\n        cells = calcCells(this.items, this.itemHeight, this.headerHeight, this.footerHeight, this.headerFn, this.footerFn, this.approxHeaderHeight, this.approxFooterHeight, this.approxItemHeight, cellIndex, offset, length);\n        this.cells = inplaceUpdate(this.cells, cells, cellIndex);\n        this.lastItemLen = this.items.length;\n        this.indexDirty = Math.max(offset - 1, 0);\n        this.scheduleUpdate();\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n  /**\n   * This method marks the tail the items array as dirty, so they can be re-rendered.\n   *\n   * It's equivalent to calling:\n   *\n   * ```js\n   * virtualScroll.checkRange(lastItemLen);\n   * ```\n   */\n\n\n  class_1.prototype.checkEnd = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      return tslib_1.__generator(this, function (_a) {\n        if (this.items) {\n          this.checkRange(this.lastItemLen);\n        }\n\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n\n  class_1.prototype.updateVirtualScroll = function () {\n    // do nothing if virtual-scroll is disabled\n    if (!this.isEnabled || !this.scrollEl) {\n      return;\n    } // unschedule future updates\n\n\n    if (this.timerUpdate) {\n      clearTimeout(this.timerUpdate);\n      this.timerUpdate = undefined;\n    } // schedule DOM operations into the stencil queue\n\n\n    readTask(this.readVS.bind(this));\n    writeTask(this.writeVS.bind(this));\n  };\n\n  class_1.prototype.readVS = function () {\n    var _a = this,\n        contentEl = _a.contentEl,\n        scrollEl = _a.scrollEl,\n        el = _a.el;\n\n    var topOffset = 0;\n    var node = el;\n\n    while (node && node !== contentEl) {\n      topOffset += node.offsetTop;\n      node = node.parentElement;\n    }\n\n    this.viewportOffset = topOffset;\n\n    if (scrollEl) {\n      this.viewportHeight = scrollEl.offsetHeight;\n      this.currentScrollTop = scrollEl.scrollTop;\n    }\n  };\n\n  class_1.prototype.writeVS = function () {\n    var dirtyIndex = this.indexDirty; // get visible viewport\n\n    var scrollTop = this.currentScrollTop - this.viewportOffset;\n    var viewport = getViewport(scrollTop, this.viewportHeight, 100); // compute lazily the height index\n\n    var heightIndex = this.getHeightIndex(); // get array bounds of visible cells base in the viewport\n\n    var range = getRange(heightIndex, viewport, 2); // fast path, do nothing\n\n    var shouldUpdate = getShouldUpdate(dirtyIndex, this.range, range);\n\n    if (!shouldUpdate) {\n      return;\n    }\n\n    this.range = range; // in place mutation of the virtual DOM\n\n    updateVDom(this.virtualDom, heightIndex, this.cells, range); // Write DOM\n    // Different code paths taken depending of the render API used\n\n    if (this.nodeRender) {\n      doRender(this.el, this.nodeRender, this.virtualDom, this.updateCellHeight.bind(this));\n    } else if (this.domRender) {\n      this.domRender(this.virtualDom);\n    } else if (this.renderItem) {\n      this.el.forceUpdate();\n    }\n  };\n\n  class_1.prototype.updateCellHeight = function (cell, node) {\n    var _this = this;\n\n    var update = function update() {\n      if (node['$ionCell'] === cell) {\n        var style = window.getComputedStyle(node);\n        var height = node.offsetHeight + parseFloat(style.getPropertyValue('margin-bottom'));\n\n        _this.setCellHeight(cell, height);\n      }\n    };\n\n    if (node && node.componentOnReady) {\n      node.componentOnReady().then(update);\n    } else {\n      update();\n    }\n  };\n\n  class_1.prototype.setCellHeight = function (cell, height) {\n    var index = cell.i; // the cell might changed since the height update was scheduled\n\n    if (cell !== this.cells[index]) {\n      return;\n    }\n\n    if (cell.height !== height || cell.visible !== true) {\n      cell.visible = true;\n      cell.height = height;\n      this.indexDirty = Math.min(this.indexDirty, index);\n      this.scheduleUpdate();\n    }\n  };\n\n  class_1.prototype.scheduleUpdate = function () {\n    var _this = this;\n\n    clearTimeout(this.timerUpdate);\n    this.timerUpdate = setTimeout(function () {\n      return _this.updateVirtualScroll();\n    }, 100);\n  };\n\n  class_1.prototype.updateState = function () {\n    var shouldEnable = !!(this.scrollEl && this.cells);\n\n    if (shouldEnable !== this.isEnabled) {\n      this.enableScrollEvents(shouldEnable);\n\n      if (shouldEnable) {\n        this.updateVirtualScroll();\n      }\n    }\n  };\n\n  class_1.prototype.calcCells = function () {\n    if (!this.items) {\n      return;\n    }\n\n    this.lastItemLen = this.items.length;\n    this.cells = calcCells(this.items, this.itemHeight, this.headerHeight, this.footerHeight, this.headerFn, this.footerFn, this.approxHeaderHeight, this.approxFooterHeight, this.approxItemHeight, 0, 0, this.lastItemLen);\n    this.indexDirty = 0;\n  };\n\n  class_1.prototype.getHeightIndex = function () {\n    if (this.indexDirty !== Infinity) {\n      this.calcHeightIndex(this.indexDirty);\n    }\n\n    return this.heightIndex;\n  };\n\n  class_1.prototype.calcHeightIndex = function (index) {\n    if (index === void 0) {\n      index = 0;\n    } // TODO: optimize, we don't need to calculate all the cells\n\n\n    this.heightIndex = resizeBuffer(this.heightIndex, this.cells.length);\n    this.totalHeight = calcHeightIndex(this.heightIndex, this.cells, index);\n    this.indexDirty = Infinity;\n  };\n\n  class_1.prototype.enableScrollEvents = function (shouldListen) {\n    var _this = this;\n\n    if (this.rmEvent) {\n      this.rmEvent();\n      this.rmEvent = undefined;\n    }\n\n    var scrollEl = this.scrollEl;\n\n    if (scrollEl) {\n      this.isEnabled = shouldListen;\n      scrollEl.addEventListener('scroll', this.onScroll);\n\n      this.rmEvent = function () {\n        scrollEl.removeEventListener('scroll', _this.onScroll);\n      };\n    }\n  };\n\n  class_1.prototype.renderVirtualNode = function (node) {\n    var _a = node.cell,\n        type = _a.type,\n        value = _a.value,\n        index = _a.index;\n\n    switch (type) {\n      case CELL_TYPE_ITEM:\n        return this.renderItem(value, index);\n\n      case CELL_TYPE_HEADER:\n        return this.renderHeader(value, index);\n\n      case CELL_TYPE_FOOTER:\n        return this.renderFooter(value, index);\n    }\n  };\n\n  class_1.prototype.render = function () {\n    var _this = this;\n\n    return h(Host, {\n      style: {\n        height: this.totalHeight + \"px\"\n      }\n    }, this.renderItem && h(VirtualProxy, {\n      dom: this.virtualDom\n    }, this.virtualDom.map(function (node) {\n      return _this.renderVirtualNode(node);\n    })));\n  };\n\n  Object.defineProperty(class_1.prototype, \"el\", {\n    get: function get() {\n      return getElement(this);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(class_1, \"watchers\", {\n    get: function get() {\n      return {\n        \"itemHeight\": [\"itemsChanged\"],\n        \"headerHeight\": [\"itemsChanged\"],\n        \"footerHeight\": [\"itemsChanged\"],\n        \"items\": [\"itemsChanged\"]\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(class_1, \"style\", {\n    get: function get() {\n      return \"ion-virtual-scroll{display:block;position:relative;width:100%;contain:strict;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}ion-virtual-scroll>.virtual-loading{opacity:0}ion-virtual-scroll>.virtual-item{position:absolute!important;top:0!important;right:0!important;left:0!important;-webkit-transition-duration:0ms;transition-duration:0ms;will-change:transform}\";\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return class_1;\n}();\n\nvar VirtualProxy = function VirtualProxy(_a, children, utils) {\n  var dom = _a.dom;\n  return utils.map(children, function (child, i) {\n    var node = dom[i];\n    var vattrs = child.vattrs || {};\n    var classes = vattrs.class || '';\n    classes += 'virtual-item ';\n\n    if (!node.visible) {\n      classes += 'virtual-loading';\n    }\n\n    return Object.assign({}, child, {\n      vattrs: Object.assign({}, vattrs, {\n        class: classes,\n        style: Object.assign({}, vattrs.style, {\n          transform: \"translate3d(0,\" + node.top + \"px,0)\"\n        })\n      })\n    });\n  });\n};\n\nexport { VirtualScroll as ion_virtual_scroll };"],"sourceRoot":""}